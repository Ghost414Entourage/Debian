sudo apt update
sudo apt install build-essential linux-source bc kmod cpio flex libncurses5-dev libelf-dev libssl-dev dwarves bison

sudo apt-get source linux-image-$(uname -r)

tar xf linux-*.tar.xz
cd linux-*

ls -l /boot | grep 6.1.0-40-cloud


cp /boot/config-$(uname -r) .config

make menuconfig

make -j$(nproc) deb-pkg LOCALVERSION=-custom

sudo dpkg -i ../linux-image-*.deb ../linux-headers-*.deb

sudo update-grub

sudo reboot

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

sudo apt-get source linux

apt-get source linux


sudo apt install build-essential dwarves pahole elfutils libelf-dev bc flex bison
sudo apt install linux-kbuild-$(uname -r | cut -d. -f1,2)


sudo apt install -y build-essential \
  elfutils libelf-dev \
  dwarves \
  pahole \
  bc \
  flex bison \
  python3



sudo apt install linux-image-$(uname -r)-dbg

git clone https://github.com/dynup/kpatch

cd kpatch

make

uname -r

sudo make install

sudo apt install linux-image-$(uname -r)-dbg

sudo mkdir -p /usr/lib/debug/boot
sudo cp /usr/lib/debug/lib/modules/$(uname -r)/vmlinux /usr/lib/debug/boot/vmlinux-$(uname -r)

cat > test.patch << 'EOF'
--- a/kernel/sched/core.c
+++ b/kernel/sched/core.c
@@ -1,3 +1,4 @@
+/* trivial test patch for kpatch */
EOF


sudo apt install -y gawk



